<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Gridea静态个人博客">
<meta name="description" content="温故而知新">
<meta name="theme-color" content="#000">
<title>Solution：MS excel 打印 跨页的 合并单元格 没有网格线 | my blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1629632070489">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/muse.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/monokai-sublime.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



  <meta name="description" content="Solution：MS excel 打印 跨页的 合并单元格 没有网格线" />
  <meta name="keywords" content="Office" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="muse">
  <header class="header bg-color ">
    <div class="blog-header box-shadow-wrapper  " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>my blog</span>
            </a>  
          
        </div>
        
          <p class="subtitle">闻道有先后 术业有专攻</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="https://ezrilei.github.io/" target="_self">
                  <i class="fa fa-globe"></i> 首页
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> 归档
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> 标签
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> 关于
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> 友情链接
                  
                </a>
              </li>
            
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout muse bg-color">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper  right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active">文章目录</span>
            <span id="metaSideBar" class="sidebar-title-item">站点概览</span>
          </div>
        </div>
      
      <div class="sidebar-body muse" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper ">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">ezrilei</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">4</span>
        <span class="site-item-stat-name">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">3</span>
        <span class="site-item-stat-name">分类</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">3</span>
        <span class="site-item-stat-name">标签</span>
      </a>
    </div>
  </div>
  
  


</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number auto"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0">问题描述</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">解决方案</a></li>
<li><a href="#%E7%BB%93%E6%9E%9C">结果</a></li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // 保存li元素
      if (elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // 处理不是从#一级标题开始目录
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://ezrilei.github.io/post/add-grid-when-printing-merged-cell/">
      Solution：MS excel 打印 跨页的 合并单元格 没有网格线
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2021-08-20</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://ezrilei.github.io/tag/uhWv1VG2w/">
        <span>Office</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>1分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>73<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
            <div class="post-body next-md-body" id="post_body">
              <img src="https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108202137594.png" width = "75%" />
<!-- more -->
<h2 id="问题描述">问题描述</h2>
<p>打印 跨页的 合并单元格 会出现部分单元格没有网格线的情况</p>
<img src="https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201646751.png" width = "75%" />
<h2 id="解决方案">解决方案</h2>
<p>页边距 - 管理自定义页边距 - 页面设置 - 工作表 - 网格线☑️</p>
<img src="https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201650651.png" width = "25%" />
<!-- more -->
<img src="https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201651612.png" width = "50%" />
<h2 id="结果">结果</h2>
<p>跨页的 合并单元格 也会显示网格线了<br>
<img src="https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201652752.png" width = "75%" /></p>

            </div>
            <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      ezrilei
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://ezrilei.github.io/post/add-grid-when-printing-merged-cell/" title="Solution：MS excel 打印 跨页的 合并单元格 没有网格线">https://ezrilei.github.io/post/add-grid-when-printing-merged-cell/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！
    </li>
  </ul>
  <div class="tags">
    
      <a href="https://ezrilei.github.io/tag/uhWv1VG2w/"># Office</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
        <i class="fa fa-chevron-left"></i>
        <a class="nav-pc-next" title="Solution：insert pdf to a blog page" href="https://ezrilei.github.io/post/inser-pdf-to-a-blog-page/">Solution：insert pdf to a blog page</a class="nav-pc-next">
        <a class="nav-mobile-prev" title="Solution：insert pdf to a blog page" href="https://ezrilei.github.io/post/inser-pdf-to-a-blog-page/">上一篇</a>
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="使用R语言批量写word文档" href="https://ezrilei.github.io/post/write-word-doc-with-R/">使用R语言批量写word文档</a>
        <a class="nav-mobile-next" title="使用R语言批量写word文档" href="https://ezrilei.github.io/post/write-word-doc-with-R/">下一篇</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | © 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      
    </div>
  </footer>
  
  
    <div class="drawer-box left" id="drawer_box">
      <span class="muse-line muse-line-first"></span>
      <span class="muse-line muse-line-middle"></span>
      <span class="muse-line muse-line-last"></span>
    </div>
  
  <div class="muse back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // 动态调整站点概览高度
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // 链接跳转
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // 代码高亮
  hljs.initHighlightingOnLoad();

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px; border: 1px solid #fff; border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //拿来主义(真香)^_^，Clipboard 实现摘自掘金 https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        console.log('复制操作频率过高');
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="搜索">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://ezrilei.github.io/post/inser-pdf-to-a-blog-page/"" data-c="
          &lt;p&gt;display pdf files via &lt;code&gt;Google Drive Viewer&lt;/code&gt; API&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;iframe src=&amp;quot;https://docs.google.com/gview?embedded=true&amp;amp;url=http://infolab.stanford.edu/pub/papers/google.pdf&amp;quot; style=&amp;quot;width:800px; height:500px;&amp;quot; frameborder=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- more --&gt;
&lt;iframe src=&#34;https://docs.google.com/gview?embedded=true&amp;url=http://infolab.stanford.edu/pub/papers/google.pdf&#34; style=&#34;width:800px; height:500px;&#34; frameborder=&#34;0&#34;&gt;&lt;/iframe&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;将 github.com 替换为 raw.githubusercontent.com ，并去除 /blob ，即为该文件的下载链接。&lt;/li&gt;
&lt;li&gt;将 &lt;code&gt;style=&amp;quot;width:800px; height:500px;&amp;quot;&lt;/code&gt; 改为 &lt;code&gt;style=&amp;quot;width: 95%; height: 500px;&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;增加居中&lt;code&gt;&amp;lt;p align=&amp;quot;center&amp;quot;&amp;gt;...&amp;lt;/p&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;p align=&amp;quot;center&amp;quot;&amp;gt;&amp;lt;iframe src=&amp;quot;https://docs.google.com/gview?embedded=true&amp;amp;url=https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pdf/pdf/%E5%8F%91%E5%B1%95%E5%85%9A%E5%91%98%E6%9D%90%E6%96%99%E6%B8%85%E5%8D%95_v3.2-20210727.pdf&amp;quot; style=&amp;quot;width: 95%; height: 500px;&amp;quot; frameborder=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p align=&#34;center&#34;&gt;&lt;iframe src=&#34;https://docs.google.com/gview?embedded=true&amp;url=https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pdf/pdf/%E5%8F%91%E5%B1%95%E5%85%9A%E5%91%98%E6%9D%90%E6%96%99%E6%B8%85%E5%8D%95_v3.2-20210727.pdf&#34; style=&#34;width: 95%; height: 500px;&#34; frameborder=&#34;0&#34;&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;p&gt;参考：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/342135587&#34;&gt;张晋, Typora嵌入视频和PDF&lt;/a&gt;&lt;/p&gt;
">Solution：insert pdf to a blog page</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://ezrilei.github.io/post/add-grid-when-printing-merged-cell/"" data-c="
          &lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108202137594.png&#34; width = &#34;75%&#34; /&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;问题描述&#34;&gt;问题描述&lt;/h2&gt;
&lt;p&gt;打印 跨页的 合并单元格 会出现部分单元格没有网格线的情况&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201646751.png&#34; width = &#34;75%&#34; /&gt;
&lt;h2 id=&#34;解决方案&#34;&gt;解决方案&lt;/h2&gt;
&lt;p&gt;页边距 - 管理自定义页边距 - 页面设置 - 工作表 - 网格线☑️&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201650651.png&#34; width = &#34;25%&#34; /&gt;
&lt;!-- more --&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201651612.png&#34; width = &#34;50%&#34; /&gt;
&lt;h2 id=&#34;结果&#34;&gt;结果&lt;/h2&gt;
&lt;p&gt;跨页的 合并单元格 也会显示网格线了&lt;br&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201652752.png&#34; width = &#34;75%&#34; /&gt;&lt;/p&gt;
">Solution：MS excel 打印 跨页的 合并单元格 没有网格线</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://ezrilei.github.io/post/write-word-doc-with-R/"" data-c="
          &lt;p&gt;需求描述：&lt;br&gt;
工作中，有时会遇到需要批量写word文档的时候，比如，写发展党员的批文的时候、临近节假日写困难党员慰问信的时候、发展对象培训班结业写证书、疫情期间打印通过审核的通行证的时候等等。这样的文档大部分内容是不变的，只有个别几个地方，需要写入信息。而这些信息可以很方便地以表格的形式呈现。&lt;/p&gt;
&lt;p&gt;当然，我们可以挨个手动将信息填到word文档中，&lt;br&gt;
- 但是一来速度不快，要耗费大量时间；&lt;br&gt;
- 二来如果填写的量很大，容易induce human error——漏字、填错位等等。&lt;/p&gt;
&lt;p&gt;解决方案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用MS word自带的&lt;code&gt;邮件合并（mail merge）&lt;/code&gt;功能&lt;/li&gt;
&lt;li&gt;用R语言的&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;函数&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;本文介绍第二个方案。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;用r语言批量写word文档一-实现功能&#34;&gt;用R语言批量写word文档（一）—— 实现功能&lt;/h1&gt;
&lt;h2 id=&#34;set-working-directory&#34;&gt;set working directory&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;#### set working directory ####
# set the folder where the RScript locates as working dir (you need Rstudio to do this)
setwd(
  dirname(rstudioapi::getSourceEditorContext()$path)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;load-packages&#34;&gt;load Packages&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;#### load Packages ####
library(readxl)
library(officer)
library(stringr)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;create-output-directory&#34;&gt;create output directory&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;#### create output dir ####
current.time &amp;lt;- Sys.time() # 先把时间记下来 免得程序跑得过久 前后命名不一致
name.dir &amp;lt;- paste0(&amp;quot;output_&amp;quot;,
                   format(current.time, &amp;quot;%m%d_%H%M&amp;quot;)
)
dir.create(name.dir)

path.tmp.dir &amp;lt;- paste(&amp;quot;.&amp;quot;, name.dir, &amp;quot;tmp/&amp;quot;, sep = &amp;quot;/&amp;quot;)
dir.create(path.tmp.dir)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;load-ttinfo&#34;&gt;load tt.info&lt;/h2&gt;
&lt;p&gt;在R语言中，我们通常把变量（Variables）放在列（column），每一行（row）为一个Observation。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;### load tt.info &amp;lt;-----------------------
path.tt.info &amp;lt;- &amp;quot;./Data/【模拟】生活困难党员摸底统计.xlsx&amp;quot;

tt.info &amp;lt;- readxl::read_excel(path = path.tt.info,
                              sheet = 1, skip = 0
                              )
&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108220932708.png&#34; width = &#34;60%&#34; /&gt;
&lt;h2 id=&#34;write-word-docmument&#34;&gt;write word docmument&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;首先制作模板.docx文件。将需要填入信息的位置，做好【标记】（如&lt;code&gt;namePerson&lt;/code&gt;, &lt;code&gt;nameBank&lt;/code&gt;, &lt;code&gt;account&lt;/code&gt;)。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;★ 建议：将文字 一次性 粘贴到文档中，这样可以使【标记的内容】，位于word文档中的 同一个chunk 的 同一个node中。反之，如果对文档多次编辑，可能会使得【标记的内容】不在同一个node，此时&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;会识别不出来，提示：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; In x$doc_obj$replace_all_text(old_value, new_value, only_at_cursor,  :
  Found 0 instances of &#39;...&#39; in the document.
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;这里后面会写一篇文章，具体讨论这个问题。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;用&lt;code&gt;officer::read_docx&lt;/code&gt;读取作为模板的.docx文件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.docx文件中的信息将以 类型（class）为&lt;code&gt;rdocx&lt;/code&gt;的R object 储存&lt;/li&gt;
&lt;li&gt;这里有个BUG：&lt;code&gt;officer_doc %&amp;gt;% body_replace_all_text(...)&lt;/code&gt;后，&lt;code&gt;officer_doc&lt;/code&gt;会变成替换后的值（模板的值会被覆盖），故每一个Observation都必须重新读取一次模板。&lt;/li&gt;
&lt;/ul&gt;
  &lt;img src=&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108220924692.png&#34; width = &#34;80%&#34; /&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;用&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;把标记替换为要填入的文字。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;最后用&lt;code&gt;print&lt;/code&gt;函数把&lt;code&gt;rdocx&lt;/code&gt;输出为pdf文件。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;#### write word documents ####
for(i in 1:nrow(tt.info)){
  # 读取 模板.docx &amp;lt;-----------------------
  officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)
  
  # def variable
  namePerson &amp;lt;- tt.info$姓名[i]
  nameBank &amp;lt;- tt.info$开户行名称[i]
  account &amp;lt;- tt.info$`开户行账号（卡号）`[i] %&amp;gt;% as.character()
  
  # 替换
  doc_replaced &amp;lt;- officer_doc %&amp;gt;%
    body_replace_all_text(old_value = &amp;quot;namePerson&amp;quot;, 
                          new_value = namePerson, 
                          only_at_cursor = FALSE
    ) %&amp;gt;%
    body_replace_all_text(old_value = &amp;quot;nameBank&amp;quot;, 
                          new_value = nameBank, 
                          only_at_cursor = FALSE
    ) %&amp;gt;% 
    body_replace_all_text(old_value = &amp;quot;account&amp;quot;, 
                          new_value = account, 
                          only_at_cursor = FALSE
    )
  #&amp;quot;./output_%m%d_%H%M/tmp/【宋江】慰问信.docx&amp;quot;
  print(doc_replaced, 
        target = paste0(path.tmp.dir, i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)
  )
  
  # progress msg
  print(
    paste0(i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;,&amp;quot;  created ✓&amp;quot;)
    )
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;merge-word-documents-into-a-single-docx-file&#34;&gt;merge word documents into a single .docx file&lt;/h2&gt;
&lt;p&gt;上一步，每个文档填入了一个Observation的信息，产生了数个文档。如果你把一个个打开，再打印，费时费力。而你肯定会被文印室的工作人员吐槽的。所以，为了减少打印设置的工作量，我们需要把所有文档，合并成一个文件，每个文档的内容之间，通过&lt;code&gt;分页符（page break）&lt;/code&gt;分隔。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;因此，我们读取第一个输出的文档，以此为基础，依次把&lt;code&gt;分页符&lt;/code&gt;和&lt;code&gt;下一个文档的信息&lt;/code&gt;放入这个&lt;code&gt;rdocx&lt;/code&gt;，最后&lt;code&gt;print&lt;/code&gt;出来就行了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;有时候，默认的文件排序不是我们所需要的，比如：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; list.files(path = path.tmp.dir)
  [1] &amp;quot;1【宋江】慰问信.docx&amp;quot;     &amp;quot;10【柴进】慰问信.docx&amp;quot;    
  [3]&amp;quot;100【孙新】慰问信.docx&amp;quot;   &amp;quot;101【顾大嫂】慰问信.docx&amp;quot;
  [5] &amp;quot;102【张青】慰问信.docx&amp;quot;   &amp;quot;103【孙二娘】慰问信.docx&amp;quot; 
  ....
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;更多的时候我们需要和.xlsx表格的数据顺序一致，比如：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  [1] ./output_0822_0956/tmp/&amp;quot;1【宋江】慰问信.docx&amp;quot;     
  [2] ./output_0822_0956/tmp/&amp;quot;2【卢俊义】慰问信.docx&amp;quot;    
  [3] ./output_0822_0956/tmp/&amp;quot;3【吴用】慰问信.docx&amp;quot;    
  ....
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以，这里我用正则表达式的 look behind&lt;code&gt;(?&amp;lt;=pattern)&lt;/code&gt;和look ahead positive assert&lt;code&gt;(?=pattern)&lt;/code&gt;，找位于&lt;code&gt;tmp/&lt;/code&gt;后面，&lt;code&gt;【&lt;/code&gt;前面的字符串，也就是我们之前写在文件名中的序号，将字符串序号转换成&lt;code&gt;numeric()&lt;/code&gt;，再排序&lt;code&gt;order()&lt;/code&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;#### merge letters into a single word doc ####
# get ordered
doc.path &amp;lt;- paste0(path.tmp.dir, 
                  list.files(path = path.tmp.dir)
)
idx &amp;lt;- doc.path %&amp;gt;% str_extract_all(pattern = &amp;quot;(?&amp;lt;=tmp/).+?(?=【)&amp;quot;) %&amp;gt;% unlist() %&amp;gt;% as.numeric() %&amp;gt;% order() 
doc.path &amp;lt;- doc.path[idx]

# merge doc
doc_merge &amp;lt;- officer::read_docx(path = doc.path[1])

for(i in 2:length(doc.path)){
 doc_merge &amp;lt;- doc_merge %&amp;gt;%
   body_add_break() %&amp;gt;% # add a page break into an rdocx object
   body_add_docx(src = doc.path[i]) # add content of a docx into an rdocx object
 
 print(
   paste0(i, &amp;quot;/&amp;quot;, length(doc.path), &amp;quot;  merged ✓&amp;quot;)
 )
}

 print(doc_merge, 
     target = paste0(name.dir,&amp;quot;/&amp;quot;, &amp;quot;【&amp;quot;, nrow(tt.info), &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)
     )
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;用r语言批量写word文档二-parallel并行运算&#34;&gt;用R语言批量写word文档（二）—— parallel并行运算&lt;/h1&gt;
&lt;p&gt;R语言默认只利用CPU单个核单线程。而显然我们&lt;code&gt;write word docmument&lt;/code&gt;那一步，各个循环之间可以独立运行，不存在谁的input依赖谁的output的情况。所以，我们可以利用&lt;code&gt;parallel::parLapply&lt;/code&gt;，把各个循环分给多个核多个线程，进行并行运算，以期减少等待的时间。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;#### set working directory ####
# set the folder where the RScript locates as working dir (you need Rstudio to do this)
setwd(
 dirname(rstudioapi::getSourceEditorContext()$path)
)

#### load Packages ####
library(readxl)
library(officer)
library(stringr)
library(parallel) # &amp;lt;----------

#### create output dir ####
current.time &amp;lt;- Sys.time() # 先把时间记下来 免得程序跑得过久 前后命名不一致
name.dir &amp;lt;- paste0(&amp;quot;output_&amp;quot;,
                  format(current.time, &amp;quot;%m%d_%H%M&amp;quot;)
)
dir.create(name.dir)

path.tmp.dir &amp;lt;- paste(&amp;quot;.&amp;quot;, name.dir, &amp;quot;tmp/&amp;quot;, sep = &amp;quot;/&amp;quot;)
dir.create(path.tmp.dir)


### load tt.info &amp;lt;-----------------------
path.tt.info &amp;lt;- &amp;quot;./Data/【模拟】生活困难党员摸底统计.xlsx&amp;quot;

tt.info &amp;lt;- readxl::read_excel(path = path.tt.info,
                             sheet = 1, skip = 0
                             )


#### def  word documents Function ####

Fun.writeDoc &amp;lt;- function(i){
 
 # 读取 模板.docx &amp;lt;-----------------------
 officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)
 
 # def variable
 namePerson &amp;lt;- tt.info$姓名[i]
 nameBank &amp;lt;- tt.info$开户行名称[i]
 account &amp;lt;- tt.info$`开户行账号（卡号）`[i] %&amp;gt;% as.character()
 
 # 替换
 doc_replaced &amp;lt;- officer_doc %&amp;gt;%
   body_replace_all_text(old_value = &amp;quot;namePerson&amp;quot;, 
                         new_value = namePerson, 
                         only_at_cursor = FALSE
   ) %&amp;gt;%
   body_replace_all_text(old_value = &amp;quot;nameBank&amp;quot;, 
                         new_value = nameBank, 
                         only_at_cursor = FALSE
   ) %&amp;gt;% 
   body_replace_all_text(old_value = &amp;quot;account&amp;quot;, 
                         new_value = account, 
                         only_at_cursor = FALSE
   )
 #&amp;quot;./output_%m%d_%H%M/tmp/【宋江】慰问信.docx&amp;quot;
 print(doc_replaced, 
       target = paste0(path.tmp.dir, i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)
 )
 
# progress msg
print(
   paste0(i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;,&amp;quot;  created ✓&amp;quot;)
   )
} # End of def Fun.writeDoc

#### def Fun.loadPackages ####
Fun.loadPackages &amp;lt;- function(packages) {
 for (p in packages) {
   library(p, character.only=TRUE)
 }
 NULL
} 

# detectCores() # 16
#### run parLapply ####
system.time({
 
 parallel.cl &amp;lt;- makeCluster(12) # 初始化12核心集群
 clusterExport(parallel.cl, &amp;quot;tt.info&amp;quot;) #将tt.info导入所有cluster
 clusterExport(parallel.cl, &amp;quot;name.dir&amp;quot;)
 clusterExport(parallel.cl, &amp;quot;path.tmp.dir&amp;quot;)
 clusterCall(parallel.cl, Fun.loadPackages, c(&amp;quot;readxl&amp;quot;, &amp;quot;officer&amp;quot;, &amp;quot;stringr&amp;quot;)) # load package into all clusters
 
 i = 1:nrow(tt.info)
 parLapply(cl = parallel.cl, X = i, fun = Fun.writeDoc) # lapply的并行版本
 
 stopCluster(parallel.cl) # 关闭集群
 
})
####_____________________####

#### merge letters into a single word doc ####
# get ordered
doc.path &amp;lt;- paste0(path.tmp.dir, 
                  list.files(path = path.tmp.dir)
)
idx &amp;lt;- doc.path %&amp;gt;% str_extract_all(pattern = &amp;quot;(?&amp;lt;=tmp/).+?(?=【)&amp;quot;) %&amp;gt;% unlist() %&amp;gt;% as.numeric() %&amp;gt;% order() 
doc.path &amp;lt;- doc.path[idx]

# merge doc
doc_merge &amp;lt;- officer::read_docx(path = doc.path[1])

for(i in 2:length(doc.path)){
 doc_merge &amp;lt;- doc_merge %&amp;gt;%
   body_add_break() %&amp;gt;% # add a page break into an rdocx object
   body_add_docx(src = doc.path[i]) # add content of a docx into an rdocx object
 
 print(
   paste0(i, &amp;quot;/&amp;quot;, length(doc.path), &amp;quot;  merged ✓&amp;quot;)
 )
}


print(doc_merge, 
     target = paste0(name.dir,&amp;quot;/&amp;quot;, &amp;quot;【&amp;quot;, nrow(tt.info), &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;用r语言批量写word文档三-常见问题解决&#34;&gt;用R语言批量写word文档（三）—— 常见问题解决&lt;/h1&gt;
&lt;h2 id=&#34;问题描述&#34;&gt;问题描述&lt;/h2&gt;
&lt;p&gt;前文提到：对文档多次编辑，可能会使得【标记的内容】不在同一个node，此时&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;会识别不出来，提示：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;In x$doc_obj$replace_all_text(old_value, new_value, only_at_cursor,  :
  Found 0 instances of &#39;...&#39; in the document.
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;原因探究&#34;&gt;原因探究&lt;/h2&gt;
&lt;p&gt;参考：&lt;a href=&#34;https://stackoverflow.com/questions/51047772/doesnt-work-body-replace-all-text-method-in-package-officer&#34;&gt;David Gohel, stackoverflow的回答&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我们可以用通过&lt;code&gt;officer::docx_show_chunk()&lt;/code&gt;显示&lt;code&gt;rdocx&lt;/code&gt; R object 每个chunk的内容。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{r}&#34;&gt;&amp;gt; officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)
&amp;gt; officer_doc %&amp;gt;% cursor_begin() %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   #cursor_forward %&amp;gt;%
+   docx_show_chunk()
18 text nodes found at this cursor. 
 &amp;lt;w:t&amp;gt;: &#39;奋斗百年路，启航新征程。希望您继续发挥&#39;
 &amp;lt;w:t&amp;gt;: &#39;党员&#39;
 &amp;lt;w:t&amp;gt;: &#39;模范带头作用，&#39;
 &amp;lt;w:t&amp;gt;: &#39;一如既往地&#39;
 &amp;lt;w:t&amp;gt;: &#39;支持全街经济社会各项工作。&#39;
 &amp;lt;w:t&amp;gt;: &#39;现将&#39;
 &amp;lt;w:t&amp;gt;: &#39;慰问金壹仟元整（&#39;
 &amp;lt;w:t&amp;gt;: &#39;1000&#39;
 &amp;lt;w:t&amp;gt;: &#39;元）&#39;
 &amp;lt;w:t&amp;gt;: &#39;汇入&#39;
 &amp;lt;w:t&amp;gt;: &#39;您的&#39;
 &amp;lt;w:t&amp;gt;: &#39;name&#39;
 &amp;lt;w:t&amp;gt;: &#39;B&#39;
 &amp;lt;w:t&amp;gt;: &#39;ank&#39;
 &amp;lt;w:t&amp;gt;: &#39;账户&#39;
 &amp;lt;w:t&amp;gt;: &#39;account&#39;
 &amp;lt;w:t&amp;gt;: &#39;，请查收&#39;
 &amp;lt;w:t&amp;gt;: &#39;。&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可以看到我们计划作为标记的&lt;code&gt;nameBank&lt;/code&gt;被分到3个nodes中：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; &amp;lt;w:t&amp;gt;: &#39;name&#39;
 &amp;lt;w:t&amp;gt;: &#39;B&#39;
 &amp;lt;w:t&amp;gt;: &#39;ank&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样的情况&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;函数识别不出来，就会提示&lt;code&gt;Found 0 instances of &#39;nameBank&#39; in the document.&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&#34;解决办法&#34;&gt;解决办法&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;把这一段的内容删去（delete）。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把这一段的内容粘到文本编辑器（以去除格式）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把文本编辑器的这一段的内容 再一块儿粘回到word文档。&lt;/p&gt;
&lt;p&gt;我们会发现：我们写的标记已经位于同一chunk的同一node中了&lt;code&gt;&amp;lt;w:t&amp;gt;: &#39;nameBank&#39;&lt;/code&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)
&amp;gt; officer_doc %&amp;gt;% cursor_begin() %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   cursor_forward %&amp;gt;% 
+   #cursor_forward %&amp;gt;%
+   docx_show_chunk()
7 text nodes found at this cursor. 
  &amp;lt;w:t&amp;gt;: &#39;奋斗百年路，启航新征程。希望您继续发挥党员模范带头作用，一如既往地支持全街经济社会各项工作。现将慰问金壹仟元整（&#39;
  &amp;lt;w:t&amp;gt;: &#39;1000&#39;
  &amp;lt;w:t&amp;gt;: &#39;元）汇入您的&#39;
  &amp;lt;w:t&amp;gt;: &#39;nameBank&#39;
  &amp;lt;w:t&amp;gt;: &#39;账户&#39;
  &amp;lt;w:t&amp;gt;: &#39;account&#39;
  &amp;lt;w:t&amp;gt;: &#39;，请查收。&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
">使用R语言批量写word文档</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://ezrilei.github.io/post/testing/"" data-c="
          &lt;pre class=&#34;r&#34;&gt;&lt;code&gt;
#### set working directory ####
# set the folder where the RScript locates as working dir (you need Rstudio to do this)
setwd(
  dirname(rstudioapi::getSourceEditorContext()$path)
)

#### load Packages ####
library(readxl)
library(officer)
library(stringr)
library(parallel) # &lt;----------

#### create output dir ####
current.time &lt;- Sys.time() # 先把时间记下来 免得程序跑得过久 前后命名不一致
name.dir &lt;- paste0(&#34;output_&#34;,
                   format(current.time, &#34;%m%d_%H%M&#34;)
)
dir.create(name.dir)

path.tmp.dir &lt;- paste(&#34;.&#34;, name.dir, &#34;tmp/&#34;, sep = &#34;/&#34;)
dir.create(path.tmp.dir)


### load tt.info &lt;-----------------------
path.tt.info &lt;- &#34;./Data/【模拟】生活困难党员摸底统计.xlsx&#34;

tt.info &lt;- readxl::read_excel(path = path.tt.info,
                              sheet = 1, skip = 0
                              )


#### def  word documents Function ####

Fun.writeDoc &lt;- function(i){
  
  # 读取 模板.docx &lt;-----------------------
  officer_doc &lt;- officer::read_docx(path = &#34;./Data/【模板】慰问信.docx&#34;)
  
  # def variable
  namePerson &lt;- tt.info$姓名[i]
  nameBank &lt;- tt.info$开户行名称[i]
  account &lt;- tt.info$`开户行账号（卡号）`[i] %&gt;% as.character()
  
  # 替换
  doc_replaced &lt;- officer_doc %&gt;%
    body_replace_all_text(old_value = &#34;namePerson&#34;, 
                          new_value = namePerson, 
                          only_at_cursor = FALSE
    ) %&gt;%
    body_replace_all_text(old_value = &#34;nameBank&#34;, 
                          new_value = nameBank, 
                          only_at_cursor = FALSE
    ) %&gt;% 
    body_replace_all_text(old_value = &#34;account&#34;, 
                          new_value = account, 
                          only_at_cursor = FALSE
    )
  #&#34;./output_%m%d_%H%M/tmp/【宋江】慰问信.docx&#34;
  print(doc_replaced, 
        target = paste0(path.tmp.dir, i,&#34;【&#34;, namePerson, &#34;】&#34;, &#34;慰问信.docx&#34;)
  )
  
  # progress msg
  print(
    paste0(i,&#34;【&#34;, namePerson, &#34;】&#34;, &#34;慰问信.docx&#34;,&#34;  created ✓&#34;)
    )
} # End of def Fun.writeDoc

#### def Fun.loadPackages ####
Fun.loadPackages &lt;- function(packages) {
  for (p in packages) {
    library(p, character.only=TRUE)
  }
  NULL
} 


#### run parLapply ####
system.time({
  
  parallel.cl &lt;- makeCluster(12) # 初始化12核心集群
  clusterExport(parallel.cl, &#34;tt.info&#34;) #将该data.frame导入所有core
  clusterExport(parallel.cl, &#34;name.dir&#34;)
  clusterExport(parallel.cl, &#34;path.tmp.dir&#34;)
  clusterCall(parallel.cl, Fun.loadPackages, c(&#34;readxl&#34;, &#34;officer&#34;, &#34;stringr&#34;))
  
  i = 1:nrow(tt.info)
  parLapply(cl = parallel.cl, X = i, fun = Fun.writeDoc) # lapply的并行版本
  
  stopCluster(parallel.cl) # 关闭集群
  
})
####_____________________####

#### merge letters into a single word doc ####
# get ordered
doc.path &lt;- paste0(path.tmp.dir, 
                   list.files(path = path.tmp.dir)
)
idx &lt;- doc.path %&gt;% str_extract_all(pattern = &#34;(?&lt;=tmp/).+?(?=【)&#34;) %&gt;% unlist() %&gt;% as.numeric() %&gt;% order() 
doc.path &lt;- doc.path[idx]

# merge doc
doc_merge &lt;- officer::read_docx(path = doc.path[1])

for(i in 2:length(doc.path)){
  doc_merge &lt;- doc_merge %&gt;%
    body_add_break() %&gt;% # add a page break into an rdocx object
    body_add_docx(src = doc.path[i]) # add content of a docx into an rdocx object
  
  print(
    paste0(i, &#34;/&#34;, length(doc.path), &#34;  merged ✓&#34;)
  )
}


print(doc_merge, 
      target = paste0(name.dir,&#34;/&#34;, &#34;【&#34;, nrow(tt.info), &#34;】&#34;, &#34;慰问信.docx&#34;)
)
&lt;/code&gt;&lt;/pre&gt;">Testing</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://ezrilei.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;欢迎来到我的小站呀，很高兴遇见你！🤝&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;关于本站&#34;&gt;🏠 关于本站&lt;/h2&gt;
&lt;h2 id=&#34;博主是谁&#34;&gt;👨‍💻 博主是谁&lt;/h2&gt;
&lt;h2 id=&#34;兴趣爱好&#34;&gt;⛹ 兴趣爱好&lt;/h2&gt;
&lt;h2 id=&#34;联系我呀&#34;&gt;📬 联系我呀&lt;/h2&gt;
">关于</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://ezrilei.github.io/post/hello-gridea/"" data-c="
          &lt;p&gt;👏  欢迎使用 &lt;strong&gt;Gridea&lt;/strong&gt; ！&lt;br&gt;
✍️  &lt;strong&gt;Gridea&lt;/strong&gt; 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/getgridea/gridea&#34;&gt;Github&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://gridea.dev/&#34;&gt;Gridea 主页&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;http://fehey.com/&#34;&gt;示例网站&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;特性&#34;&gt;特性👇&lt;/h2&gt;
&lt;p&gt;📝  你可以使用最酷的 &lt;strong&gt;Markdown&lt;/strong&gt; 语法，进行快速创作&lt;/p&gt;
&lt;p&gt;🌉  你可以给文章配上精美的封面图和在文章任意位置插入图片&lt;/p&gt;
&lt;p&gt;🏷️  你可以对文章进行标签分组&lt;/p&gt;
&lt;p&gt;📋  你可以自定义菜单，甚至可以创建外部链接菜单&lt;/p&gt;
&lt;p&gt;💻  你可以在 &lt;strong&gt;Windows&lt;/strong&gt;，&lt;strong&gt;MacOS&lt;/strong&gt; 或 &lt;strong&gt;Linux&lt;/strong&gt; 设备上使用此客户端&lt;/p&gt;
&lt;p&gt;🌎  你可以使用 &lt;strong&gt;𝖦𝗂𝗍𝗁𝗎𝖻 𝖯𝖺𝗀𝖾𝗌&lt;/strong&gt; 或 &lt;strong&gt;Coding Pages&lt;/strong&gt; 向世界展示，未来将支持更多平台&lt;/p&gt;
&lt;p&gt;💬  你可以进行简单的配置，接入 &lt;a href=&#34;https://github.com/gitalk/gitalk&#34;&gt;Gitalk&lt;/a&gt; 或 &lt;a href=&#34;https://github.com/SukkaW/DisqusJS&#34;&gt;DisqusJS&lt;/a&gt; 评论系统&lt;/p&gt;
&lt;p&gt;🇬🇧  你可以使用&lt;strong&gt;中文简体&lt;/strong&gt;或&lt;strong&gt;英语&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;🌁  你可以任意使用应用内默认主题或任意第三方主题，强大的主题自定义能力&lt;/p&gt;
&lt;p&gt;🖥  你可以自定义源文件夹，利用 OneDrive、百度网盘、iCloud、Dropbox 等进行多设备同步&lt;/p&gt;
&lt;p&gt;🌱 当然 &lt;strong&gt;Gridea&lt;/strong&gt; 还很年轻，有很多不足，但请相信，它会不停向前 🏃&lt;/p&gt;
&lt;p&gt;未来，它一定会成为你离不开的伙伴&lt;/p&gt;
&lt;p&gt;尽情发挥你的才华吧！&lt;/p&gt;
&lt;p&gt;😘 Enjoy~&lt;/p&gt;
">Hello Gridea</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;p&gt;display pdf files via &lt;code&gt;Google Drive Viewer&lt;/code&gt; API&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;&amp;lt;iframe src=&amp;quot;https://docs.google.com/gview?embedded=true&amp;amp;url=http://infolab.stanford.edu/pub/papers/google.pdf&amp;quot; style=&amp;quot;width:800px; height:500px;&amp;quot; frameborder=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;!-- more --&gt;\n&lt;iframe src=\&#34;https://docs.google.com/gview?embedded=true&amp;url=http://infolab.stanford.edu/pub/papers/google.pdf\&#34; style=\&#34;width:800px; height:500px;\&#34; frameborder=\&#34;0\&#34;&gt;&lt;/iframe&gt;\n&lt;hr&gt;\n&lt;ul&gt;\n&lt;li&gt;将 github.com 替换为 raw.githubusercontent.com ，并去除 /blob ，即为该文件的下载链接。&lt;/li&gt;\n&lt;li&gt;将 &lt;code&gt;style=&amp;quot;width:800px; height:500px;&amp;quot;&lt;/code&gt; 改为 &lt;code&gt;style=&amp;quot;width: 95%; height: 500px;&amp;quot;&lt;/code&gt;&lt;/li&gt;\n&lt;li&gt;增加居中&lt;code&gt;&amp;lt;p align=&amp;quot;center&amp;quot;&amp;gt;...&amp;lt;/p&amp;gt;&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;&amp;lt;p align=&amp;quot;center&amp;quot;&amp;gt;&amp;lt;iframe src=&amp;quot;https://docs.google.com/gview?embedded=true&amp;amp;url=https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pdf/pdf/%E5%8F%91%E5%B1%95%E5%85%9A%E5%91%98%E6%9D%90%E6%96%99%E6%B8%85%E5%8D%95_v3.2-20210727.pdf&amp;quot; style=&amp;quot;width: 95%; height: 500px;&amp;quot; frameborder=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;/p&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p align=\&#34;center\&#34;&gt;&lt;iframe src=\&#34;https://docs.google.com/gview?embedded=true&amp;url=https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pdf/pdf/%E5%8F%91%E5%B1%95%E5%85%9A%E5%91%98%E6%9D%90%E6%96%99%E6%B8%85%E5%8D%95_v3.2-20210727.pdf\&#34; style=\&#34;width: 95%; height: 500px;\&#34; frameborder=\&#34;0\&#34;&gt;&lt;/iframe&gt;&lt;/p&gt;\n&lt;p&gt;参考：&lt;a href=\&#34;https://zhuanlan.zhihu.com/p/342135587\&#34;&gt;张晋, Typora嵌入视频和PDF&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;inser-pdf-to-a-blog-page&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;display pdf files via &lt;code&gt;Google Drive Viewer&lt;/code&gt; API&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;&amp;lt;iframe src=&amp;quot;https://docs.google.com/gview?embedded=true&amp;amp;url=http://infolab.stanford.edu/pub/papers/google.pdf&amp;quot; style=&amp;quot;width:800px; height:500px;&amp;quot; frameborder=&amp;quot;0&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;title&#34;:&#34;Solution：insert pdf to a blog page&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Gridea&#34;,&#34;slug&#34;:&#34;LpqqSMDoL&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://ezrilei.github.io/tag/LpqqSMDoL/&#34;}],&#34;date&#34;:&#34;2021-08-21 23:30:20&#34;,&#34;dateFormat&#34;:&#34;2021-08-21&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://ezrilei.github.io/post/inser-pdf-to-a-blog-page/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:62000,&#34;words&#34;:183,&#34;minutes&#34;:2},&#34;description&#34;:&#34;display pdf files via Google Drive Viewer API\n&amp;lt;iframe src=&amp;quot;https://docs.google.com/gview?embedded=true&amp;amp;url=h...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108202137594.png\&#34; width = \&#34;75%\&#34; /&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;问题描述\&#34;&gt;问题描述&lt;/h2&gt;\n&lt;p&gt;打印 跨页的 合并单元格 会出现部分单元格没有网格线的情况&lt;/p&gt;\n&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201646751.png\&#34; width = \&#34;75%\&#34; /&gt;\n&lt;h2 id=\&#34;解决方案\&#34;&gt;解决方案&lt;/h2&gt;\n&lt;p&gt;页边距 - 管理自定义页边距 - 页面设置 - 工作表 - 网格线☑️&lt;/p&gt;\n&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201650651.png\&#34; width = \&#34;25%\&#34; /&gt;\n&lt;!-- more --&gt;\n&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201651612.png\&#34; width = \&#34;50%\&#34; /&gt;\n&lt;h2 id=\&#34;结果\&#34;&gt;结果&lt;/h2&gt;\n&lt;p&gt;跨页的 合并单元格 也会显示网格线了&lt;br&gt;\n&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108201652752.png\&#34; width = \&#34;75%\&#34; /&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;add-grid-when-printing-merged-cell&#34;,&#34;abstract&#34;:&#34;&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108202137594.png\&#34; width = \&#34;75%\&#34; /&gt;&#34;,&#34;title&#34;:&#34;Solution：MS excel 打印 跨页的 合并单元格 没有网格线&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Office&#34;,&#34;slug&#34;:&#34;uhWv1VG2w&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://ezrilei.github.io/tag/uhWv1VG2w/&#34;}],&#34;date&#34;:&#34;2021-08-20 21:00:03&#34;,&#34;dateFormat&#34;:&#34;2021-08-20&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://ezrilei.github.io/post/add-grid-when-printing-merged-cell/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:14000,&#34;words&#34;:73,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\n\n问题描述\n打印 跨页的 合并单元格 会出现部分单元格没有网格线的情况\n\n解决方案\n页边距 - 管理自定义页边距 - 页面设置 - 工作表 - 网格线☑️\n\n\n\n结果\n跨页的 合并单元格 也会显示网格线了\n\n...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0\&#34;&gt;问题描述&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\&#34;&gt;解决方案&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BB%93%E6%9E%9C\&#34;&gt;结果&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;需求描述：&lt;br&gt;\n工作中，有时会遇到需要批量写word文档的时候，比如，写发展党员的批文的时候、临近节假日写困难党员慰问信的时候、发展对象培训班结业写证书、疫情期间打印通过审核的通行证的时候等等。这样的文档大部分内容是不变的，只有个别几个地方，需要写入信息。而这些信息可以很方便地以表格的形式呈现。&lt;/p&gt;\n&lt;p&gt;当然，我们可以挨个手动将信息填到word文档中，&lt;br&gt;\n- 但是一来速度不快，要耗费大量时间；&lt;br&gt;\n- 二来如果填写的量很大，容易induce human error——漏字、填错位等等。&lt;/p&gt;\n&lt;p&gt;解决方案：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;用MS word自带的&lt;code&gt;邮件合并（mail merge）&lt;/code&gt;功能&lt;/li&gt;\n&lt;li&gt;用R语言的&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;函数&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;本文介绍第二个方案。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;用r语言批量写word文档一-实现功能\&#34;&gt;用R语言批量写word文档（一）—— 实现功能&lt;/h1&gt;\n&lt;h2 id=\&#34;set-working-directory\&#34;&gt;set working directory&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;#### set working directory ####\n# set the folder where the RScript locates as working dir (you need Rstudio to do this)\nsetwd(\n  dirname(rstudioapi::getSourceEditorContext()$path)\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;load-packages\&#34;&gt;load Packages&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;#### load Packages ####\nlibrary(readxl)\nlibrary(officer)\nlibrary(stringr)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;create-output-directory\&#34;&gt;create output directory&lt;/h2&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;#### create output dir ####\ncurrent.time &amp;lt;- Sys.time() # 先把时间记下来 免得程序跑得过久 前后命名不一致\nname.dir &amp;lt;- paste0(&amp;quot;output_&amp;quot;,\n                   format(current.time, &amp;quot;%m%d_%H%M&amp;quot;)\n)\ndir.create(name.dir)\n\npath.tmp.dir &amp;lt;- paste(&amp;quot;.&amp;quot;, name.dir, &amp;quot;tmp/&amp;quot;, sep = &amp;quot;/&amp;quot;)\ndir.create(path.tmp.dir)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;load-ttinfo\&#34;&gt;load tt.info&lt;/h2&gt;\n&lt;p&gt;在R语言中，我们通常把变量（Variables）放在列（column），每一行（row）为一个Observation。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;### load tt.info &amp;lt;-----------------------\npath.tt.info &amp;lt;- &amp;quot;./Data/【模拟】生活困难党员摸底统计.xlsx&amp;quot;\n\ntt.info &amp;lt;- readxl::read_excel(path = path.tt.info,\n                              sheet = 1, skip = 0\n                              )\n&lt;/code&gt;&lt;/pre&gt;\n&lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108220932708.png\&#34; width = \&#34;60%\&#34; /&gt;\n&lt;h2 id=\&#34;write-word-docmument\&#34;&gt;write word docmument&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;首先制作模板.docx文件。将需要填入信息的位置，做好【标记】（如&lt;code&gt;namePerson&lt;/code&gt;, &lt;code&gt;nameBank&lt;/code&gt;, &lt;code&gt;account&lt;/code&gt;)。&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;★ 建议：将文字 一次性 粘贴到文档中，这样可以使【标记的内容】，位于word文档中的 同一个chunk 的 同一个node中。反之，如果对文档多次编辑，可能会使得【标记的内容】不在同一个node，此时&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;会识别不出来，提示：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt; In x$doc_obj$replace_all_text(old_value, new_value, only_at_cursor,  :\n  Found 0 instances of &#39;...&#39; in the document.\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;这里后面会写一篇文章，具体讨论这个问题。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;用&lt;code&gt;officer::read_docx&lt;/code&gt;读取作为模板的.docx文件。&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;.docx文件中的信息将以 类型（class）为&lt;code&gt;rdocx&lt;/code&gt;的R object 储存&lt;/li&gt;\n&lt;li&gt;这里有个BUG：&lt;code&gt;officer_doc %&amp;gt;% body_replace_all_text(...)&lt;/code&gt;后，&lt;code&gt;officer_doc&lt;/code&gt;会变成替换后的值（模板的值会被覆盖），故每一个Observation都必须重新读取一次模板。&lt;/li&gt;\n&lt;/ul&gt;\n  &lt;img src=\&#34;https://raw.githubusercontent.com/ezrilei/WhereThePicLay/pic/img/202108220924692.png\&#34; width = \&#34;80%\&#34; /&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;用&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;把标记替换为要填入的文字。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;最后用&lt;code&gt;print&lt;/code&gt;函数把&lt;code&gt;rdocx&lt;/code&gt;输出为pdf文件。&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;#### write word documents ####\nfor(i in 1:nrow(tt.info)){\n  # 读取 模板.docx &amp;lt;-----------------------\n  officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)\n  \n  # def variable\n  namePerson &amp;lt;- tt.info$姓名[i]\n  nameBank &amp;lt;- tt.info$开户行名称[i]\n  account &amp;lt;- tt.info$`开户行账号（卡号）`[i] %&amp;gt;% as.character()\n  \n  # 替换\n  doc_replaced &amp;lt;- officer_doc %&amp;gt;%\n    body_replace_all_text(old_value = &amp;quot;namePerson&amp;quot;, \n                          new_value = namePerson, \n                          only_at_cursor = FALSE\n    ) %&amp;gt;%\n    body_replace_all_text(old_value = &amp;quot;nameBank&amp;quot;, \n                          new_value = nameBank, \n                          only_at_cursor = FALSE\n    ) %&amp;gt;% \n    body_replace_all_text(old_value = &amp;quot;account&amp;quot;, \n                          new_value = account, \n                          only_at_cursor = FALSE\n    )\n  #&amp;quot;./output_%m%d_%H%M/tmp/【宋江】慰问信.docx&amp;quot;\n  print(doc_replaced, \n        target = paste0(path.tmp.dir, i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)\n  )\n  \n  # progress msg\n  print(\n    paste0(i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;,&amp;quot;  created ✓&amp;quot;)\n    )\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;merge-word-documents-into-a-single-docx-file\&#34;&gt;merge word documents into a single .docx file&lt;/h2&gt;\n&lt;p&gt;上一步，每个文档填入了一个Observation的信息，产生了数个文档。如果你把一个个打开，再打印，费时费力。而你肯定会被文印室的工作人员吐槽的。所以，为了减少打印设置的工作量，我们需要把所有文档，合并成一个文件，每个文档的内容之间，通过&lt;code&gt;分页符（page break）&lt;/code&gt;分隔。&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;因此，我们读取第一个输出的文档，以此为基础，依次把&lt;code&gt;分页符&lt;/code&gt;和&lt;code&gt;下一个文档的信息&lt;/code&gt;放入这个&lt;code&gt;rdocx&lt;/code&gt;，最后&lt;code&gt;print&lt;/code&gt;出来就行了。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;有时候，默认的文件排序不是我们所需要的，比如：&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;&amp;gt; list.files(path = path.tmp.dir)\n  [1] &amp;quot;1【宋江】慰问信.docx&amp;quot;     &amp;quot;10【柴进】慰问信.docx&amp;quot;    \n  [3]&amp;quot;100【孙新】慰问信.docx&amp;quot;   &amp;quot;101【顾大嫂】慰问信.docx&amp;quot;\n  [5] &amp;quot;102【张青】慰问信.docx&amp;quot;   &amp;quot;103【孙二娘】慰问信.docx&amp;quot; \n  ....\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;更多的时候我们需要和.xlsx表格的数据顺序一致，比如：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;  [1] ./output_0822_0956/tmp/&amp;quot;1【宋江】慰问信.docx&amp;quot;     \n  [2] ./output_0822_0956/tmp/&amp;quot;2【卢俊义】慰问信.docx&amp;quot;    \n  [3] ./output_0822_0956/tmp/&amp;quot;3【吴用】慰问信.docx&amp;quot;    \n  ....\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;所以，这里我用正则表达式的 look behind&lt;code&gt;(?&amp;lt;=pattern)&lt;/code&gt;和look ahead positive assert&lt;code&gt;(?=pattern)&lt;/code&gt;，找位于&lt;code&gt;tmp/&lt;/code&gt;后面，&lt;code&gt;【&lt;/code&gt;前面的字符串，也就是我们之前写在文件名中的序号，将字符串序号转换成&lt;code&gt;numeric()&lt;/code&gt;，再排序&lt;code&gt;order()&lt;/code&gt;。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;#### merge letters into a single word doc ####\n# get ordered\ndoc.path &amp;lt;- paste0(path.tmp.dir, \n                  list.files(path = path.tmp.dir)\n)\nidx &amp;lt;- doc.path %&amp;gt;% str_extract_all(pattern = &amp;quot;(?&amp;lt;=tmp/).+?(?=【)&amp;quot;) %&amp;gt;% unlist() %&amp;gt;% as.numeric() %&amp;gt;% order() \ndoc.path &amp;lt;- doc.path[idx]\n\n# merge doc\ndoc_merge &amp;lt;- officer::read_docx(path = doc.path[1])\n\nfor(i in 2:length(doc.path)){\n doc_merge &amp;lt;- doc_merge %&amp;gt;%\n   body_add_break() %&amp;gt;% # add a page break into an rdocx object\n   body_add_docx(src = doc.path[i]) # add content of a docx into an rdocx object\n \n print(\n   paste0(i, &amp;quot;/&amp;quot;, length(doc.path), &amp;quot;  merged ✓&amp;quot;)\n )\n}\n\n print(doc_merge, \n     target = paste0(name.dir,&amp;quot;/&amp;quot;, &amp;quot;【&amp;quot;, nrow(tt.info), &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)\n     )\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;用r语言批量写word文档二-parallel并行运算\&#34;&gt;用R语言批量写word文档（二）—— parallel并行运算&lt;/h1&gt;\n&lt;p&gt;R语言默认只利用CPU单个核单线程。而显然我们&lt;code&gt;write word docmument&lt;/code&gt;那一步，各个循环之间可以独立运行，不存在谁的input依赖谁的output的情况。所以，我们可以利用&lt;code&gt;parallel::parLapply&lt;/code&gt;，把各个循环分给多个核多个线程，进行并行运算，以期减少等待的时间。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;#### set working directory ####\n# set the folder where the RScript locates as working dir (you need Rstudio to do this)\nsetwd(\n dirname(rstudioapi::getSourceEditorContext()$path)\n)\n\n#### load Packages ####\nlibrary(readxl)\nlibrary(officer)\nlibrary(stringr)\nlibrary(parallel) # &amp;lt;----------\n\n#### create output dir ####\ncurrent.time &amp;lt;- Sys.time() # 先把时间记下来 免得程序跑得过久 前后命名不一致\nname.dir &amp;lt;- paste0(&amp;quot;output_&amp;quot;,\n                  format(current.time, &amp;quot;%m%d_%H%M&amp;quot;)\n)\ndir.create(name.dir)\n\npath.tmp.dir &amp;lt;- paste(&amp;quot;.&amp;quot;, name.dir, &amp;quot;tmp/&amp;quot;, sep = &amp;quot;/&amp;quot;)\ndir.create(path.tmp.dir)\n\n\n### load tt.info &amp;lt;-----------------------\npath.tt.info &amp;lt;- &amp;quot;./Data/【模拟】生活困难党员摸底统计.xlsx&amp;quot;\n\ntt.info &amp;lt;- readxl::read_excel(path = path.tt.info,\n                             sheet = 1, skip = 0\n                             )\n\n\n#### def  word documents Function ####\n\nFun.writeDoc &amp;lt;- function(i){\n \n # 读取 模板.docx &amp;lt;-----------------------\n officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)\n \n # def variable\n namePerson &amp;lt;- tt.info$姓名[i]\n nameBank &amp;lt;- tt.info$开户行名称[i]\n account &amp;lt;- tt.info$`开户行账号（卡号）`[i] %&amp;gt;% as.character()\n \n # 替换\n doc_replaced &amp;lt;- officer_doc %&amp;gt;%\n   body_replace_all_text(old_value = &amp;quot;namePerson&amp;quot;, \n                         new_value = namePerson, \n                         only_at_cursor = FALSE\n   ) %&amp;gt;%\n   body_replace_all_text(old_value = &amp;quot;nameBank&amp;quot;, \n                         new_value = nameBank, \n                         only_at_cursor = FALSE\n   ) %&amp;gt;% \n   body_replace_all_text(old_value = &amp;quot;account&amp;quot;, \n                         new_value = account, \n                         only_at_cursor = FALSE\n   )\n #&amp;quot;./output_%m%d_%H%M/tmp/【宋江】慰问信.docx&amp;quot;\n print(doc_replaced, \n       target = paste0(path.tmp.dir, i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)\n )\n \n# progress msg\nprint(\n   paste0(i,&amp;quot;【&amp;quot;, namePerson, &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;,&amp;quot;  created ✓&amp;quot;)\n   )\n} # End of def Fun.writeDoc\n\n#### def Fun.loadPackages ####\nFun.loadPackages &amp;lt;- function(packages) {\n for (p in packages) {\n   library(p, character.only=TRUE)\n }\n NULL\n} \n\n# detectCores() # 16\n#### run parLapply ####\nsystem.time({\n \n parallel.cl &amp;lt;- makeCluster(12) # 初始化12核心集群\n clusterExport(parallel.cl, &amp;quot;tt.info&amp;quot;) #将tt.info导入所有cluster\n clusterExport(parallel.cl, &amp;quot;name.dir&amp;quot;)\n clusterExport(parallel.cl, &amp;quot;path.tmp.dir&amp;quot;)\n clusterCall(parallel.cl, Fun.loadPackages, c(&amp;quot;readxl&amp;quot;, &amp;quot;officer&amp;quot;, &amp;quot;stringr&amp;quot;)) # load package into all clusters\n \n i = 1:nrow(tt.info)\n parLapply(cl = parallel.cl, X = i, fun = Fun.writeDoc) # lapply的并行版本\n \n stopCluster(parallel.cl) # 关闭集群\n \n})\n####_____________________####\n\n#### merge letters into a single word doc ####\n# get ordered\ndoc.path &amp;lt;- paste0(path.tmp.dir, \n                  list.files(path = path.tmp.dir)\n)\nidx &amp;lt;- doc.path %&amp;gt;% str_extract_all(pattern = &amp;quot;(?&amp;lt;=tmp/).+?(?=【)&amp;quot;) %&amp;gt;% unlist() %&amp;gt;% as.numeric() %&amp;gt;% order() \ndoc.path &amp;lt;- doc.path[idx]\n\n# merge doc\ndoc_merge &amp;lt;- officer::read_docx(path = doc.path[1])\n\nfor(i in 2:length(doc.path)){\n doc_merge &amp;lt;- doc_merge %&amp;gt;%\n   body_add_break() %&amp;gt;% # add a page break into an rdocx object\n   body_add_docx(src = doc.path[i]) # add content of a docx into an rdocx object\n \n print(\n   paste0(i, &amp;quot;/&amp;quot;, length(doc.path), &amp;quot;  merged ✓&amp;quot;)\n )\n}\n\n\nprint(doc_merge, \n     target = paste0(name.dir,&amp;quot;/&amp;quot;, &amp;quot;【&amp;quot;, nrow(tt.info), &amp;quot;】&amp;quot;, &amp;quot;慰问信.docx&amp;quot;)\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;用r语言批量写word文档三-常见问题解决\&#34;&gt;用R语言批量写word文档（三）—— 常见问题解决&lt;/h1&gt;\n&lt;h2 id=\&#34;问题描述\&#34;&gt;问题描述&lt;/h2&gt;\n&lt;p&gt;前文提到：对文档多次编辑，可能会使得【标记的内容】不在同一个node，此时&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;会识别不出来，提示：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;In x$doc_obj$replace_all_text(old_value, new_value, only_at_cursor,  :\n  Found 0 instances of &#39;...&#39; in the document.\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;原因探究\&#34;&gt;原因探究&lt;/h2&gt;\n&lt;p&gt;参考：&lt;a href=\&#34;https://stackoverflow.com/questions/51047772/doesnt-work-body-replace-all-text-method-in-package-officer\&#34;&gt;David Gohel, stackoverflow的回答&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;我们可以用通过&lt;code&gt;officer::docx_show_chunk()&lt;/code&gt;显示&lt;code&gt;rdocx&lt;/code&gt; R object 每个chunk的内容。&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-{r}\&#34;&gt;&amp;gt; officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)\n&amp;gt; officer_doc %&amp;gt;% cursor_begin() %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   #cursor_forward %&amp;gt;%\n+   docx_show_chunk()\n18 text nodes found at this cursor. \n &amp;lt;w:t&amp;gt;: &#39;奋斗百年路，启航新征程。希望您继续发挥&#39;\n &amp;lt;w:t&amp;gt;: &#39;党员&#39;\n &amp;lt;w:t&amp;gt;: &#39;模范带头作用，&#39;\n &amp;lt;w:t&amp;gt;: &#39;一如既往地&#39;\n &amp;lt;w:t&amp;gt;: &#39;支持全街经济社会各项工作。&#39;\n &amp;lt;w:t&amp;gt;: &#39;现将&#39;\n &amp;lt;w:t&amp;gt;: &#39;慰问金壹仟元整（&#39;\n &amp;lt;w:t&amp;gt;: &#39;1000&#39;\n &amp;lt;w:t&amp;gt;: &#39;元）&#39;\n &amp;lt;w:t&amp;gt;: &#39;汇入&#39;\n &amp;lt;w:t&amp;gt;: &#39;您的&#39;\n &amp;lt;w:t&amp;gt;: &#39;name&#39;\n &amp;lt;w:t&amp;gt;: &#39;B&#39;\n &amp;lt;w:t&amp;gt;: &#39;ank&#39;\n &amp;lt;w:t&amp;gt;: &#39;账户&#39;\n &amp;lt;w:t&amp;gt;: &#39;account&#39;\n &amp;lt;w:t&amp;gt;: &#39;，请查收&#39;\n &amp;lt;w:t&amp;gt;: &#39;。&#39;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;可以看到我们计划作为标记的&lt;code&gt;nameBank&lt;/code&gt;被分到3个nodes中：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt; &amp;lt;w:t&amp;gt;: &#39;name&#39;\n &amp;lt;w:t&amp;gt;: &#39;B&#39;\n &amp;lt;w:t&amp;gt;: &#39;ank&#39;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;这样的情况&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;函数识别不出来，就会提示&lt;code&gt;Found 0 instances of &#39;nameBank&#39; in the document.&lt;/code&gt;。&lt;/p&gt;\n&lt;h2 id=\&#34;解决办法\&#34;&gt;解决办法&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;把这一段的内容删去（delete）。&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;把这一段的内容粘到文本编辑器（以去除格式）&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;把文本编辑器的这一段的内容 再一块儿粘回到word文档。&lt;/p&gt;\n&lt;p&gt;我们会发现：我们写的标记已经位于同一chunk的同一node中了&lt;code&gt;&amp;lt;w:t&amp;gt;: &#39;nameBank&#39;&lt;/code&gt;。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;&amp;gt; officer_doc &amp;lt;- officer::read_docx(path = &amp;quot;./Data/【模板】慰问信.docx&amp;quot;)\n&amp;gt; officer_doc %&amp;gt;% cursor_begin() %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   cursor_forward %&amp;gt;% \n+   #cursor_forward %&amp;gt;%\n+   docx_show_chunk()\n7 text nodes found at this cursor. \n  &amp;lt;w:t&amp;gt;: &#39;奋斗百年路，启航新征程。希望您继续发挥党员模范带头作用，一如既往地支持全街经济社会各项工作。现将慰问金壹仟元整（&#39;\n  &amp;lt;w:t&amp;gt;: &#39;1000&#39;\n  &amp;lt;w:t&amp;gt;: &#39;元）汇入您的&#39;\n  &amp;lt;w:t&amp;gt;: &#39;nameBank&#39;\n  &amp;lt;w:t&amp;gt;: &#39;账户&#39;\n  &amp;lt;w:t&amp;gt;: &#39;account&#39;\n  &amp;lt;w:t&amp;gt;: &#39;，请查收。&#39;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;fileName&#34;:&#34;write-word-doc-with-R&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;需求描述：&lt;br&gt;\n工作中，有时会遇到需要批量写word文档的时候，比如，写发展党员的批文的时候、临近节假日写困难党员慰问信的时候、发展对象培训班结业写证书、疫情期间打印通过审核的通行证的时候等等。这样的文档大部分内容是不变的，只有个别几个地方，需要写入信息。而这些信息可以很方便地以表格的形式呈现。&lt;/p&gt;\n&lt;p&gt;当然，我们可以挨个手动将信息填到word文档中，&lt;br&gt;\n- 但是一来速度不快，要耗费大量时间；&lt;br&gt;\n- 二来如果填写的量很大，容易induce human error——漏字、填错位等等。&lt;/p&gt;\n&lt;p&gt;解决方案：&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;用MS word自带的&lt;code&gt;邮件合并（mail merge）&lt;/code&gt;功能&lt;/li&gt;\n&lt;li&gt;用R语言的&lt;code&gt;officer::body_replace_all_text&lt;/code&gt;函数&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;本文介绍第二个方案。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;使用R语言批量写word文档&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;R&#34;,&#34;slug&#34;:&#34;aB69pETyr&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://ezrilei.github.io/tag/aB69pETyr/&#34;}],&#34;date&#34;:&#34;2021-07-06 08:26:22&#34;,&#34;dateFormat&#34;:&#34;2021-07-06&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://ezrilei.github.io/post/write-word-doc-with-R/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;12 min read&#34;,&#34;time&#34;:703000,&#34;words&#34;:2487,&#34;minutes&#34;:12},&#34;description&#34;:&#34;需求描述：\n工作中，有时会遇到需要批量写word文档的时候，比如，写发展党员的批文的时候、临近节假日写困难党员慰问信的时候、发展对象培训班结业写证书、疫情期间打印通过审核的通行证的时候等等。这样的文档大部分内容是不变的，只有个别几个地方，需...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8r%E8%AF%AD%E8%A8%80%E6%89%B9%E9%87%8F%E5%86%99word%E6%96%87%E6%A1%A3%E4%B8%80-%E5%AE%9E%E7%8E%B0%E5%8A%9F%E8%83%BD\&#34;&gt;用R语言批量写word文档（一）—— 实现功能&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#set-working-directory\&#34;&gt;set working directory&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#load-packages\&#34;&gt;load Packages&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#create-output-directory\&#34;&gt;create output directory&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#load-ttinfo\&#34;&gt;load tt.info&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#write-word-docmument\&#34;&gt;write word docmument&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#merge-word-documents-into-a-single-docx-file\&#34;&gt;merge word documents into a single .docx file&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8r%E8%AF%AD%E8%A8%80%E6%89%B9%E9%87%8F%E5%86%99word%E6%96%87%E6%A1%A3%E4%BA%8C-parallel%E5%B9%B6%E8%A1%8C%E8%BF%90%E7%AE%97\&#34;&gt;用R语言批量写word文档（二）—— parallel并行运算&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8r%E8%AF%AD%E8%A8%80%E6%89%B9%E9%87%8F%E5%86%99word%E6%96%87%E6%A1%A3%E4%B8%89-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3\&#34;&gt;用R语言批量写word文档（三）—— 常见问题解决&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0\&#34;&gt;问题描述&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8E%9F%E5%9B%A0%E6%8E%A2%E7%A9%B6\&#34;&gt;原因探究&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95\&#34;&gt;解决办法&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;pre class=\&#34;r\&#34;&gt;&lt;code&gt;\n#### set working directory ####\n# set the folder where the RScript locates as working dir (you need Rstudio to do this)\nsetwd(\n  dirname(rstudioapi::getSourceEditorContext()$path)\n)\n\n#### load Packages ####\nlibrary(readxl)\nlibrary(officer)\nlibrary(stringr)\nlibrary(parallel) # &lt;----------\n\n#### create output dir ####\ncurrent.time &lt;- Sys.time() # 先把时间记下来 免得程序跑得过久 前后命名不一致\nname.dir &lt;- paste0(\&#34;output_\&#34;,\n                   format(current.time, \&#34;%m%d_%H%M\&#34;)\n)\ndir.create(name.dir)\n\npath.tmp.dir &lt;- paste(\&#34;.\&#34;, name.dir, \&#34;tmp/\&#34;, sep = \&#34;/\&#34;)\ndir.create(path.tmp.dir)\n\n\n### load tt.info &lt;-----------------------\npath.tt.info &lt;- \&#34;./Data/【模拟】生活困难党员摸底统计.xlsx\&#34;\n\ntt.info &lt;- readxl::read_excel(path = path.tt.info,\n                              sheet = 1, skip = 0\n                              )\n\n\n#### def  word documents Function ####\n\nFun.writeDoc &lt;- function(i){\n  \n  # 读取 模板.docx &lt;-----------------------\n  officer_doc &lt;- officer::read_docx(path = \&#34;./Data/【模板】慰问信.docx\&#34;)\n  \n  # def variable\n  namePerson &lt;- tt.info$姓名[i]\n  nameBank &lt;- tt.info$开户行名称[i]\n  account &lt;- tt.info$`开户行账号（卡号）`[i] %&gt;% as.character()\n  \n  # 替换\n  doc_replaced &lt;- officer_doc %&gt;%\n    body_replace_all_text(old_value = \&#34;namePerson\&#34;, \n                          new_value = namePerson, \n                          only_at_cursor = FALSE\n    ) %&gt;%\n    body_replace_all_text(old_value = \&#34;nameBank\&#34;, \n                          new_value = nameBank, \n                          only_at_cursor = FALSE\n    ) %&gt;% \n    body_replace_all_text(old_value = \&#34;account\&#34;, \n                          new_value = account, \n                          only_at_cursor = FALSE\n    )\n  #\&#34;./output_%m%d_%H%M/tmp/【宋江】慰问信.docx\&#34;\n  print(doc_replaced, \n        target = paste0(path.tmp.dir, i,\&#34;【\&#34;, namePerson, \&#34;】\&#34;, \&#34;慰问信.docx\&#34;)\n  )\n  \n  # progress msg\n  print(\n    paste0(i,\&#34;【\&#34;, namePerson, \&#34;】\&#34;, \&#34;慰问信.docx\&#34;,\&#34;  created ✓\&#34;)\n    )\n} # End of def Fun.writeDoc\n\n#### def Fun.loadPackages ####\nFun.loadPackages &lt;- function(packages) {\n  for (p in packages) {\n    library(p, character.only=TRUE)\n  }\n  NULL\n} \n\n\n#### run parLapply ####\nsystem.time({\n  \n  parallel.cl &lt;- makeCluster(12) # 初始化12核心集群\n  clusterExport(parallel.cl, \&#34;tt.info\&#34;) #将该data.frame导入所有core\n  clusterExport(parallel.cl, \&#34;name.dir\&#34;)\n  clusterExport(parallel.cl, \&#34;path.tmp.dir\&#34;)\n  clusterCall(parallel.cl, Fun.loadPackages, c(\&#34;readxl\&#34;, \&#34;officer\&#34;, \&#34;stringr\&#34;))\n  \n  i = 1:nrow(tt.info)\n  parLapply(cl = parallel.cl, X = i, fun = Fun.writeDoc) # lapply的并行版本\n  \n  stopCluster(parallel.cl) # 关闭集群\n  \n})\n####_____________________####\n\n#### merge letters into a single word doc ####\n# get ordered\ndoc.path &lt;- paste0(path.tmp.dir, \n                   list.files(path = path.tmp.dir)\n)\nidx &lt;- doc.path %&gt;% str_extract_all(pattern = \&#34;(?&lt;=tmp/).+?(?=【)\&#34;) %&gt;% unlist() %&gt;% as.numeric() %&gt;% order() \ndoc.path &lt;- doc.path[idx]\n\n# merge doc\ndoc_merge &lt;- officer::read_docx(path = doc.path[1])\n\nfor(i in 2:length(doc.path)){\n  doc_merge &lt;- doc_merge %&gt;%\n    body_add_break() %&gt;% # add a page break into an rdocx object\n    body_add_docx(src = doc.path[i]) # add content of a docx into an rdocx object\n  \n  print(\n    paste0(i, \&#34;/\&#34;, length(doc.path), \&#34;  merged ✓\&#34;)\n  )\n}\n\n\nprint(doc_merge, \n      target = paste0(name.dir,\&#34;/\&#34;, \&#34;【\&#34;, nrow(tt.info), \&#34;】\&#34;, \&#34;慰问信.docx\&#34;)\n)\n&lt;/code&gt;&lt;/pre&gt;&#34;,&#34;fileName&#34;:&#34;testing&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Testing&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2021-07-05 22:36:02&#34;,&#34;dateFormat&#34;:&#34;2021-07-05&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://ezrilei.github.io/post/testing/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:true,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:12000,&#34;words&#34;:34,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\n#### set working directory ####\n# set the folder where the RScript locates as working dir (you need Rstudio to do this)...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;欢迎来到我的小站呀，很高兴遇见你！🤝&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;关于本站\&#34;&gt;🏠 关于本站&lt;/h2&gt;\n&lt;h2 id=\&#34;博主是谁\&#34;&gt;👨‍💻 博主是谁&lt;/h2&gt;\n&lt;h2 id=\&#34;兴趣爱好\&#34;&gt;⛹ 兴趣爱好&lt;/h2&gt;\n&lt;h2 id=\&#34;联系我呀\&#34;&gt;📬 联系我呀&lt;/h2&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;关于&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2019-01-25 19:09:48&#34;,&#34;dateFormat&#34;:&#34;2019-01-25&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://ezrilei.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:6000,&#34;words&#34;:31,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\n欢迎来到我的小站呀，很高兴遇见你！🤝\n\n🏠 关于本站\n👨‍💻 博主是谁\n⛹ 兴趣爱好\n📬 联系我呀\n...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99\&#34;&gt;🏠 关于本站&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81\&#34;&gt;👨‍💻 博主是谁&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD\&#34;&gt;⛹ 兴趣爱好&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80\&#34;&gt;📬 联系我呀&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;👏  欢迎使用 &lt;strong&gt;Gridea&lt;/strong&gt; ！&lt;br&gt;\n✍️  &lt;strong&gt;Gridea&lt;/strong&gt; 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;&lt;a href=\&#34;https://github.com/getgridea/gridea\&#34;&gt;Github&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://gridea.dev/\&#34;&gt;Gridea 主页&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;http://fehey.com/\&#34;&gt;示例网站&lt;/a&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;特性\&#34;&gt;特性👇&lt;/h2&gt;\n&lt;p&gt;📝  你可以使用最酷的 &lt;strong&gt;Markdown&lt;/strong&gt; 语法，进行快速创作&lt;/p&gt;\n&lt;p&gt;🌉  你可以给文章配上精美的封面图和在文章任意位置插入图片&lt;/p&gt;\n&lt;p&gt;🏷️  你可以对文章进行标签分组&lt;/p&gt;\n&lt;p&gt;📋  你可以自定义菜单，甚至可以创建外部链接菜单&lt;/p&gt;\n&lt;p&gt;💻  你可以在 &lt;strong&gt;Windows&lt;/strong&gt;，&lt;strong&gt;MacOS&lt;/strong&gt; 或 &lt;strong&gt;Linux&lt;/strong&gt; 设备上使用此客户端&lt;/p&gt;\n&lt;p&gt;🌎  你可以使用 &lt;strong&gt;𝖦𝗂𝗍𝗁𝗎𝖻 𝖯𝖺𝗀𝖾𝗌&lt;/strong&gt; 或 &lt;strong&gt;Coding Pages&lt;/strong&gt; 向世界展示，未来将支持更多平台&lt;/p&gt;\n&lt;p&gt;💬  你可以进行简单的配置，接入 &lt;a href=\&#34;https://github.com/gitalk/gitalk\&#34;&gt;Gitalk&lt;/a&gt; 或 &lt;a href=\&#34;https://github.com/SukkaW/DisqusJS\&#34;&gt;DisqusJS&lt;/a&gt; 评论系统&lt;/p&gt;\n&lt;p&gt;🇬🇧  你可以使用&lt;strong&gt;中文简体&lt;/strong&gt;或&lt;strong&gt;英语&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;🌁  你可以任意使用应用内默认主题或任意第三方主题，强大的主题自定义能力&lt;/p&gt;\n&lt;p&gt;🖥  你可以自定义源文件夹，利用 OneDrive、百度网盘、iCloud、Dropbox 等进行多设备同步&lt;/p&gt;\n&lt;p&gt;🌱 当然 &lt;strong&gt;Gridea&lt;/strong&gt; 还很年轻，有很多不足，但请相信，它会不停向前 🏃&lt;/p&gt;\n&lt;p&gt;未来，它一定会成为你离不开的伙伴&lt;/p&gt;\n&lt;p&gt;尽情发挥你的才华吧！&lt;/p&gt;\n&lt;p&gt;😘 Enjoy~&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;hello-gridea&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;👏  欢迎使用 &lt;strong&gt;Gridea&lt;/strong&gt; ！&lt;br&gt;\n✍️  &lt;strong&gt;Gridea&lt;/strong&gt; 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Hello Gridea&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Gridea&#34;,&#34;slug&#34;:&#34;LpqqSMDoL&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://ezrilei.github.io/tag/LpqqSMDoL/&#34;}],&#34;date&#34;:&#34;2018-12-12 00:00:00&#34;,&#34;dateFormat&#34;:&#34;2018-12-12&#34;,&#34;feature&#34;:&#34;https://ezrilei.github.io/post-images/hello-gridea.png&#34;,&#34;link&#34;:&#34;https://ezrilei.github.io/post/hello-gridea/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:62000,&#34;words&#34;:298,&#34;minutes&#34;:2},&#34;description&#34;:&#34;👏  欢迎使用 Gridea ！\n✍️  Gridea 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...\n\nGithub\nGridea 主页\n示例网站\n特性👇\n📝  你可以使用最酷的 Markdo...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%89%B9%E6%80%A7\&#34;&gt;特性👇&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->

<script src="/media/js/mouse/peace.js"></script>


</html>